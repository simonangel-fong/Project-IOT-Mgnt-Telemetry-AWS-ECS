# IoT Management Telemetry - K6 Testing

[Back](../../README.md)

- [IoT Management Telemetry - K6 Testing](#iot-management-telemetry---k6-testing)
  - [CI Testing Plan](#ci-testing-plan)
  - [Local Testing](#local-testing)
  - [AWS Testing - Dev](#aws-testing---dev)
  - [AWS Testing - Prod](#aws-testing---prod)
  - [AWS Testing - HP](#aws-testing---hp)

---

## CI Testing Plan

- `Smoke Test`

  - **Goal**: Quickly verify that key endpoints and the test setup work before heavier tests.
  - **Load**: Very low RPS (e.g., 5–20) for about 1 minute.
  - **Focus Metrics**:
    - HTTP status (mainly 200s)
    - Basic correctness (JSON shape, key fields)
    - Connectivity and basic latency (nothing obviously broken)

- `Baseline / Ramp-up Test`

  - **Goal**: Understand normal, steady-state performance at expected real-world load.
  - **Load**: Gradual ramp up to target RPS over 5–15 minutes.
  - **Focus Metrics**:
    - RPS
    - p50 / p95 / p99 latency
    - Error rate
    - **Infrastructure metrics**: CPU, memory, DB connections

- `Spike Test`

  - **Goal**: See how the system behaves under sudden, short bursts of high traffic.
  - **Load**: Short bursts (2–5 minutes) of much higher RPS than normal.
  - **Focus Metrics**:
    - Error rate and timeouts during the spike
    - Latency spikes and recovery time after the spike
    - Autoscaling or protective mechanisms (if any) triggering correctly

- `Stress Test`

  - **Goal**: Find the system’s breaking point and how it fails when overloaded.
  - **Load**: Gradually increase load until performance clearly degrades or resources saturate.
  - **Focus Metrics**:
    - Maximum sustainable RPS before degradation
    - Error rate and failure patterns
    - Resource limits: CPU, memory, DB connection pool, threads/workers

- `Soak (Endurance) Test`

  - **Goal**: Detect long-term issues like memory leaks or slow degradation.
  - **Load**: Moderate, realistic load for a long period (1–4+ hours).
  - **Focus Metrics**:
    - Memory usage over time (no steady creep)
    - Open file descriptors / connections (no leaks)
    - Error rate stability
    - Latency drift or performance degradation over time

- Typical order of execution: `Smoke` → `Baseline/Ramp-up` → `Spike` → `Stress` → `Soak`.

---

## Local Testing

```sh
# start service
docker compose -f app/docker-compose.yaml down -v && docker compose -f app/docker-compose.yaml up -d --build

# smoke testing
docker run --rm --name k6_smoke --net=app_public_network -p 5665:5665 -e BASE_URL="http://nginx:8080" -e K6_WEB_DASHBOARD=true -e K6_WEB_DASHBOARD_EXPORT=/report/test_smoke.html -v ./k6/script:/script -v ./k6/report:/report/ grafana/k6 run /script/test_smoke.js


# baseline(ramp-up) testing
docker run --rm --name k6_baseline --net=app_public_network -p 5665:5665 -e BASE_URL="http://nginx:8080" -e K6_WEB_DASHBOARD=true -e K6_WEB_DASHBOARD_EXPORT=/report/test_baseline.html -v ./k6/script:/scripts -v ./k6/report:/report/ grafana/k6 run /scripts/test_baseline.js


# load testing (Normal)
docker run --rm --name k6_baseline --net=app_public_network -p 5665:5665 -e BASE_URL="http://nginx:8080" -e K6_WEB_DASHBOARD=true -e K6_WEB_DASHBOARD_EXPORT=/report/test_load.html -v ./k6/script:/scripts -v ./k6/report:/report/ grafana/k6 run /scripts/test_load.js


# soak testing (Same as load testing but for 8 hours)
docker run --rm --name k6_baseline --net=app_public_network -p 5665:5665 -e BASE_URL="http://nginx:8080" -e K6_WEB_DASHBOARD=true -e K6_WEB_DASHBOARD_EXPORT=/report/test_soak.html -v ./k6/script:/scripts -v ./k6/report:/report/ grafana/k6 run /scripts/test_soak.js


# spike testing
docker run --rm --name k6_spike --net=app_public_network -p 5665:5665 -e BASE_URL="http://nginx:8080" -e K6_WEB_DASHBOARD=true -e K6_WEB_DASHBOARD_EXPORT=/report/test_spike.html -v ./k6/script:/scripts -v ./k6/report:/report/ grafana/k6 run /scripts/test_spike.js


# stress testing
docker run --rm --name k6_stress --net=app_public_network -p 5665:5665 -e BASE_URL="http://nginx:8080" -e K6_WEB_DASHBOARD=true -e K6_WEB_DASHBOARD_EXPORT=/report/test_stress.html -v ./k6/script:/scripts -v ./k6/report:/report/ grafana/k6 run /scripts/test_stress.js

```

---

## AWS Testing - Dev

```sh
# smoke testing
docker run --rm --name k6_smoke -p 5665:5665 -e BASE_URL="https://iot-dev.arguswatcher.net" -e K6_WEB_DASHBOARD=true -e K6_WEB_DASHBOARD_EXPORT=/report/aws_test_smoke.html -v ./k6/script:/script -v ./k6/report:/report/ grafana/k6 run /script/test_smoke.js


# baseline(ramp-up) testing
docker run --rm --name k6_baseline -p 5665:5665 -e BASE_URL="https://iot-dev.arguswatcher.net" -e K6_WEB_DASHBOARD=true -e K6_WEB_DASHBOARD_EXPORT=/report/test_baseline.html -v ./k6/script:/scripts -v ./k6/report:/report/ grafana/k6 run /scripts/test_baseline.js


# load testing (Normal)
docker run --rm --name k6_baseline -p 5665:5665 -e BASE_URL="https://iot-dev.arguswatcher.net" -e K6_WEB_DASHBOARD=true -e K6_WEB_DASHBOARD_EXPORT=/report/test_load.html -v ./k6/script:/scripts -v ./k6/report:/report/ grafana/k6 run /scripts/test_load.js


# soak testing (Same as load testing but for 8 hours)
docker run --rm --name k6_baseline -p 5665:5665 -e BASE_URL="http://iot-dev.arguswatcher.net" -e K6_WEB_DASHBOARD=true -e K6_WEB_DASHBOARD_EXPORT=/report/test_soak.html -v ./k6/script:/scripts -v ./k6/report:/report/ grafana/k6 run /scripts/test_soak.js


# spike testing
docker run --rm --name k6_spike -p 5665:5665 -e BASE_URL="https://iot-dev.arguswatcher.net" -e K6_WEB_DASHBOARD=true -e K6_WEB_DASHBOARD_EXPORT=/report/test_spike.html -v ./k6/script:/scripts -v ./k6/report:/report/ grafana/k6 run /scripts/test_spike.js


# stress testing
docker run --rm --name k6_stress -p 5665:5665 -e BASE_URL="https://iot-dev.arguswatcher.net" -e K6_WEB_DASHBOARD=true -e K6_WEB_DASHBOARD_EXPORT=/report/test_stress.html -v ./k6/script:/scripts -v ./k6/report:/report/ grafana/k6 run /scripts/test_stress.js
```

---

## AWS Testing - Prod

```sh
# smoke testing
docker run --rm --name k6_smoke -p 5665:5665 -e BASE_URL="https://iot.arguswatcher.net" -e K6_WEB_DASHBOARD=true -e K6_WEB_DASHBOARD_EXPORT=/report/aws_test_smoke.html -v ./k6/script:/script -v ./k6/report:/report/ grafana/k6 run /script/test_smoke.js


# baseline(ramp-up) testing
docker run --rm --name k6_baseline -p 5665:5665 -e BASE_URL="https://iot.arguswatcher.net" -e K6_WEB_DASHBOARD=true -e K6_WEB_DASHBOARD_EXPORT=/report/test_baseline.html -v ./k6/script:/scripts -v ./k6/report:/report/ grafana/k6 run /scripts/test_baseline.js


# load testing (Normal)
docker run --rm --name k6_baseline -p 5665:5665 -e BASE_URL="https://iot.arguswatcher.net" -e K6_WEB_DASHBOARD=true -e K6_WEB_DASHBOARD_EXPORT=/report/test_load.html -v ./k6/script:/scripts -v ./k6/report:/report/ grafana/k6 run /scripts/test_load.js


# soak testing (Same as load testing but for 8 hours)
docker run --rm --name k6_baseline -p 5665:5665 -e BASE_URL="https://iot.arguswatcher.net" -e K6_WEB_DASHBOARD=true -e K6_WEB_DASHBOARD_EXPORT=/report/test_soak.html -v ./k6/script:/scripts -v ./k6/report:/report/ grafana/k6 run /scripts/test_soak.js


# spike testing
docker run --rm --name k6_spike -p 5665:5665 -e BASE_URL="https://iot.arguswatcher.net" -e K6_WEB_DASHBOARD=true -e K6_WEB_DASHBOARD_EXPORT=/report/test_spike.html -v ./k6/script:/scripts -v ./k6/report:/report/ grafana/k6 run /scripts/test_spike.js


# stress testing
docker run --rm --name k6_stress -p 5665:5665 -e BASE_URL="https://iot.arguswatcher.net" -e K6_WEB_DASHBOARD=true -e K6_WEB_DASHBOARD_EXPORT=/report/test_stress.html -v ./k6/script:/scripts -v ./k6/report:/report/ grafana/k6 run /scripts/test_stress.js
```

---

## AWS Testing - HP


```sh
# reading
docker run --rm --name k6_hp_read -p 5665:5665 -e BASE_URL="https://iot.arguswatcher.net" -e K6_WEB_DASHBOARD=true -e K6_WEB_DASHBOARD_EXPORT=/report/test_stress.html -v ./k6/script:/scripts -v ./k6/report:/report/ grafana/k6 run /scripts/test_hp_read.js

# write
docker run --rm --name k6_hp_write -p 5665:5665 -e BASE_URL="https://iot.arguswatcher.net" -e K6_WEB_DASHBOARD=true -e K6_WEB_DASHBOARD_EXPORT=/report/test_stress.html -v ./k6/script:/scripts -v ./k6/report:/report/ grafana/k6 run /scripts/test_hp_write.js

# rw
docker run --rm --name k6_hp_rw -p 5665:5665 -e BASE_URL="https://iot.arguswatcher.net" -e K6_WEB_DASHBOARD=true -e K6_WEB_DASHBOARD_EXPORT=/report/test_stress.html -v ./k6/script:/scripts -v ./k6/report:/report/ grafana/k6 run /scripts/test_hp_rw.js
```
